<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AB Wallet</title>
    <link rel="stylesheet" href="style.css">
    <!-- Material Icons font -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <!-- Telegram WebApp Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- App Logic -->
    <script defer src="firebase.js"></script>
</head>
<body class="dark-theme"> <!-- Default to dark theme -->

    <div id="app-container">
        <!-- Loading Overlay -->
        <div id="loading-overlay">
            <div class="spinner"></div>
            <p>Loading AB Wallet...</p>
        </div>

        <!-- Main Content Area -->
        <main id="main-content">

            <!-- Home Page -->
            <div id="home-page" class="page active">
                <header class="page-header">
                    <h1>Portfolio</h1>
                    <button id="refresh-button" class="icon-button" title="Refresh Data" aria-label="Refresh Data">
                        <span class="material-icons-outlined">refresh</span>
                    </button>
                </header>

                 <section class="content-section total-balance-section">
                    <h2>Total Estimated Value</h2>
                    <div class="total-balance-card card">
                        <span class="currency-symbol">$</span>
                        <span class="balance-amount" id="total-balance-display">0.00</span>
                        <span class="currency-code">USD</span>
                    </div>
                 </section>

                 <section class="content-section asset-list-section">
                     <h2>Your Assets</h2>
                     <div id="asset-list" class="asset-list-container">
                         <p class="no-assets placeholder-text">Loading assets...</p>
                         <!-- Asset cards injected by JS -->
                     </div>
                 </section>

                 <section class="content-section transaction-history-section">
                    <h2>Recent Transactions</h2>
                    <div id="transaction-list" class="transaction-list-container card">
                        <p class="no-transactions placeholder-text">Loading transactions...</p>
                        <!-- Transaction items injected by JS -->
                    </div>
                 </section>

                <section class="content-section user-info-section">
                    <h2>Account Info</h2>
                    <div class="user-info-card card" id="user-info-display">
                        <p class="placeholder-text">Loading user data...</p>
                    </div>
                </section>
            </div>

            <!-- Swap Page -->
            <div id="swap-page" class="page">
                 <header class="page-header">
                    <button class="back-button icon-button" data-target="home-page" aria-label="Back">
                        <span class="material-icons-outlined">arrow_back</span>
                    </button>
                    <h1>Swap Assets</h1>
                    <div class="header-spacer"></div> <!-- For centering title -->
                 </header>
                 <section class="content-section swap-section card">
                     <div class="swap-interface">
                         <!-- From Section -->
                         <div class="swap-box">
                             <label for="swap-from-amount">You Pay</label>
                             <div class="input-line">
                                 <input type="number" class="amount-input" id="swap-from-amount" placeholder="0" step="any" min="0">
                                 <div class="token-selector-container">
                                     <button class="token-selector-button" id="swap-from-token-button">
                                         <img src="placeholder.png" alt="-" class="token-logo">
                                         <span class="token-symbol">Select</span>
                                         <span class="material-icons-outlined arrow">expand_more</span>
                                     </button>
                                 </div>
                             </div>
                             <div class="balance-info subtle-text" id="swap-from-balance">Balance: -</div>
                         </div>

                         <div class="swap-icon-container">
                              <button id="swap-switch-button" class="icon-button switch-button" title="Switch Tokens" aria-label="Switch Tokens">
                                  <span class="material-icons-outlined">swap_vert</span>
                                </button>
                         </div>

                         <!-- To Section -->
                         <div class="swap-box">
                             <label for="swap-to-amount">You Receive (Estimated)</label>
                             <div class="input-line">
                                 <input type="number" class="amount-input" id="swap-to-amount" placeholder="0" step="any" disabled>
                                 <div class="token-selector-container">
                                     <button class="token-selector-button" id="swap-to-token-button">
                                          <img src="placeholder.png" alt="-" class="token-logo">
                                          <span class="token-symbol">Select</span>
                                          <span class="material-icons-outlined arrow">expand_more</span>
                                     </button>
                                 </div>
                             </div>
                              <div class="balance-info subtle-text" id="swap-to-balance">Balance: -</div>
                         </div>
                    </div>

                     <div class="swap-details">
                         <div class="swap-rate-info subtle-text" id="swap-rate-display">Select tokens to view rate</div>
                         <p class="fee-info subtle-text" id="swap-fee-info">Fee: 0.1%</p>
                     </div>
                     <button id="execute-swap-button" class="action-button primary-button" disabled>Swap</button>
                     <p id="swap-status" class="status-message"></p>
                 </section>
            </div>

            <!-- Receive Page (Deposit Tab) -->
            <div id="deposit-page" class="page">
                <header class="page-header">
                     <button class="back-button icon-button" data-target="home-page" aria-label="Back">
                         <span class="material-icons-outlined">arrow_back</span>
                     </button>
                     <h1>Receive Funds</h1>
                     <div class="header-spacer"></div>
                </header>
                <section class="content-section card">
                    <p class="info-text">Share your Chat ID below for other AB Wallet users to send funds to you.</p>
                    <div class="deposit-info-card">
                        <h3>Your AB Wallet Chat ID</h3>
                        <div class="chat-id-display">
                           <span id="deposit-chat-id" class="mono-text">Loading...</span>
                           <button class="copy-button icon-button subtle-button" title="Copy Chat ID" data-clipboard-target="#deposit-chat-id" aria-label="Copy Chat ID">
                               <span class="material-icons-outlined">content_copy</span>
                           </button>
                        </div>
                    </div>
                    <p class="info-text" style="margin-top: 20px;">Received funds will appear in your balance automatically.</p>
                </section>
            </div>

            <!-- Send Page (Withdraw Tab) -->
            <div id="withdraw-page" class="page">
                <header class="page-header">
                    <button class="back-button icon-button" data-target="home-page" aria-label="Back">
                         <span class="material-icons-outlined">arrow_back</span>
                    </button>
                    <h1>Send Funds</h1>
                    <div class="header-spacer"></div>
                </header>
                 <section class="content-section card">
                     <div class="form-group">
                         <label for="withdraw-asset-select">Asset to Send:</label>
                         <select id="withdraw-asset-select">
                             <option value="">-- Select Asset --</option>
                             <!-- Options populated by JS -->
                         </select>
                         <p class="current-balance-info subtle-text">Available: <strong id="withdraw-available-balance">-</strong></p>
                     </div>
                    <div class="form-group">
                        <label for="withdraw-recipient-id">Recipient's Chat ID:</label>
                        <input type="number" id="withdraw-recipient-id" placeholder="Enter recipient's numeric Chat ID">
                    </div>
                    <div class="form-group">
                        <label for="withdraw-amount">Amount:</label>
                        <div class="input-with-button">
                            <input type="number" id="withdraw-amount" placeholder="0.00" step="any" min="0">
                            <button id="withdraw-max-button" class="secondary-button">Max</button>
                        </div>
                    </div>
                    <button id="send-button" class="action-button primary-button" disabled>Send Funds</button>
                    <p id="withdraw-status" class="status-message"></p>
                 </section>
            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav id="bottom-nav">
            <button data-page="home-page" class="nav-button active" aria-label="Home">
                 <span class="material-icons-outlined">account_balance_wallet</span>
                <span>Home</span>
            </button>
            <button data-page="swap-page" class="nav-button" aria-label="Swap">
                <span class="material-icons-outlined">swap_horiz</span>
                <span>Swap</span>
            </button>
            <button data-page="deposit-page" class="nav-button" aria-label="Receive">
                <span class="material-icons-outlined">call_received</span>
                <span>Receive</span>
            </button>
            <button data-page="withdraw-page" class="nav-button" aria-label="Send">
                 <span class="material-icons-outlined">send</span>
                <span>Send</span>
            </button>
        </nav>

         <!-- Token Selector Modal -->
         <div id="token-selector-modal" class="modal">
             <div class="modal-content card">
                 <div class="modal-header">
                     <h2>Select Token</h2>
                     <button class="close-modal-button icon-button subtle-button" aria-label="Close">
                        <span class="material-icons-outlined">close</span>
                     </button>
                 </div>
                 <div class="modal-body">
                     <input type="text" id="token-search-input" placeholder="Search name or symbol...">
                     <ul id="token-list-modal">
                         <li class="placeholder-text">Loading tokens...</li>
                         <!-- Populated by JS -->
                     </ul>
                 </div>
             </div>
         </div>

    </div> <!-- End #app-container -->

    <!-- Clipboard JS for Copy Button -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
    <script>
        // Initialize ClipboardJS after the DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof ClipboardJS === 'function') {
                 var clipboard = new ClipboardJS('.copy-button');
                 clipboard.on('success', function(e) {
                     const icon = e.trigger.querySelector('.material-icons-outlined');
                     const originalIcon = icon ? icon.textContent : '';
                     if(icon) {
                         icon.textContent = 'done'; // Visual feedback: checkmark
                         e.trigger.classList.add('copied'); // Add class for potential styling
                     }
                     e.clearSelection();
                     // Revert after a delay
                     setTimeout(() => {
                         if(icon) icon.textContent = originalIcon;
                         e.trigger.classList.remove('copied');
                     }, 1500);
                 });
                 clipboard.on('error', function(e) {
                     console.error('Clipboard error:', e);
                     // Optionally provide user feedback on copy error
                     const icon = e.trigger.querySelector('.material-icons-outlined');
                      if(icon) icon.textContent = 'error_outline'; // Error icon
                      setTimeout(() => { if(icon) icon.textContent = 'content_copy'; }, 1500); // Revert later
                 });
            } else {
                console.warn("ClipboardJS library not loaded.");
            }
        });
    </script>

</body>
</html>
